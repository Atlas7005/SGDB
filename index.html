<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Primary Meta Tags -->
        <title>Steam Group Database</title>
        <meta name="title" content="Steam Group Database">
        <meta name="description" content="A database made for making browsing Steam groups easy.">

        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://atlas7005.github.io/SGDB/">
        <meta property="og:title" content="Steam Group Database">
        <meta property="og:description" content="A database made for making browsing Steam groups easy.">
        <meta property="og:image" content="https://atlas7005.github.io/SGDB/meta.png">

        <!-- Twitter -->
        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="https://atlas7005.github.io/SGDB/">
        <meta property="twitter:title" content="Steam Group Database">
        <meta property="twitter:description" content="A database made for making browsing Steam groups easy.">
        <meta property="twitter:image" content="https://atlas7005.github.io/SGDB/meta.png">
        <title>Steam Group Database</title>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.0/font/bootstrap-icons.css">
        <style>
            .status {
                display: inline-block;
                border-radius: 50%;
                width: .8em;
                height: .8em;
                vertical-align: middle;
            }

            .card-body p {
                margin-bottom: .5rem;
            }

            .status.open {
                background-color: rgb(0, 255, 0);
            }

            .status.restricted {
                background-color: rgb(255, 255, 0);
            }

            .status.closed {
                background-color: rgb(255, 0, 0);
            }
        </style>
    </head>
    <body class="bg-dark text-light">
        <div class="container-fluid py-5 min-vh-100">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <h1>Steam Group Database</h1>
                        <p>Search Steam Groups by name, url, status, or clan tag.</p>
                    </div>
                </div>

                <div class="row row-cols-lg g-3 align-items-center">
                    <div class="col-12">
                        <div class="input-group mb-3">
                            <input type="search" class="form-control" placeholder="Search" aria-label="Search" autocomplete="off">

                            <select class="form-select-sm" id="searchBy">
                                <option value="name">Name</option>
                                <option value="slug">URL</option>
                                <option value="status">Status</option>
                                <option value="tag">Clan Tag</option>
                            </select>

                            <button class="btn btn-success" id="searchBtn" type="button">Search</button>
                        </div>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-12">
                        <div id="search-results" class="row row-cols-5 g-4"></div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <nav>
                            <ul class="pagination justify-content-center">
                                <li class="page-item disabled"><a class="page-link" id="previous" href="javascript:void()">Previous</a></li>
                                <li class="page-item active"><a class="page-link" id="curpage" href="javascript:void()">1</a></li>
                                <li class="page-item"><a class="page-link" id="next" href="javascript:void()">Next</a></li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>

        <div class="container-fluid bg-light text-dark">
            <footer class="py-3">
                <ul class="nav justify-content-center border-bottom pb-2 mb-3 fs-3">
                    <li class="nav-item"><a href="https://github.com/Atlas7005/SGDB/" target="_blank" class="nav-link px-2 text-dark"><i class="bi bi-github"></i></a></li>
                    <li class="nav-item"><a href="https://steamcommunity.com/id/developeratlas/" target="_blank" class="nav-link px-2 text-dark"><i class="bi bi-steam"></i></a></li>
                    <li class="nav-item"><a href="mailto:atlasdevelopmentbusiness@gmail.com" target="_blank" class="nav-link px-2 text-dark"><i class="bi bi-envelope-fill"></i></a></li>
                </ul>
                <p class="text-center">Â© 2022 <a href="https://github.com/atlas7005/" target="_blank" class="text-dark text-decoration-none">Atlas Development</a></p>
            </footer>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <script>
            let page = 0;
            let curSearchTerm = "";
            const baseURL = `https://sgroupdb.herokuapp.com`;

            function escape(str) {
                return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
            }

            function showGroups(data) {
                $("#search-results").html("");
                data.forEach(group => {
                    $("#search-results").append(`
                        <div class="col">
                            <div class="card bg-light text-dark g-0">
                                <img src="${group.avatar}" class="card-img-top" />
                                <div class="card-body">
                                    <h5 class="card-title">${escape(group.name)}</h5>
                                    <p class="card-text mb-"><b>Tag:</b> ${escape(group.tag)}</p>
                                    <p class="card-text"><b>Status:</b> <i class="status ${group.status}"></i> ${group.status.charAt(0).toUpperCase() + group.status.slice(1)}</p>
                                    <p class="card-text"><b>URL:</b> <a href="https://steamcommunity.com/groups/${group.slug}" target="_blank">${group.slug}</a></p>
                                </div>
                            </div>
                        </div>
                    `);
                });
            }

            $("input").keyup(function(e) {
                if (e.keyCode == 13) {
                    $("#searchBtn").click();
                }
            });

            $("#searchBtn").click(e => {
                e.preventDefault();

                $("#search-results").html("<div class='spinner-border text-primary' role='status'></div>");

                const searchBy = $("#searchBy").val();
                const searchTerm = $("input[type='search']").val();

                if(curSearchTerm.toLowerCase().trim() != searchTerm.toLowerCase().trim()) {
                    page = 0;
                    curSearchTerm = searchTerm.toLowerCase().trim();
                    $("#curpage").html("1");
                    $("#previous").parent().hasClass("disabled") ? null : $("#previous").parent().addClass("disabled");
                }
                
                if(searchTerm.trim().length > 0) {
                    $.getJSON(`${baseURL}/api/groups/search/${searchBy}?search=${encodeURIComponent(searchTerm)}&page=${page}`, (data) => { showGroups(data) }).fail((data) => {
                        $("#search-results").html(`<div class="alert alert-danger" role="alert">${data.responseJSON.error}</div>`);
                    });
                } else {
                    $.getJSON(`${baseURL}/api/groups/all/${page}`, (data) => { showGroups(data) }).fail((data) => {
                        $("#search-results").html(`<div class="alert alert-danger" role="alert">${data.responseJSON.error}</div>`);
                    });
                }
            });

            $("#next").click(e => {
                e.preventDefault();
                page++;
                $("#searchBtn").click();
                $("#previous").parent().removeClass("disabled");
                $("#curpage").html(page+1);
            });

            $("#previous").click(e => {
                e.preventDefault();
                page--;
                $("#searchBtn").click();
                if(page == 0) {
                    $("#previous").parent().addClass("disabled");
                }
                $("#curpage").html(page+1);
            });

            $("#searchBtn").click();
        </script>
    </body>
</html>
